if (localStorage.getItem("cart") == null) {
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem("cart"));
}

function addToCart() {
    let item_id = this.id.toString().split("_")[1];

    if (cart[item_id] != undefined) {
        quantity = cart[item_id][0] + 1;
        cart[item_id][0] = quantity;
        cart[item_id][2] = cart[item_id][2] + parseFloat(document.getElementById("price" + item_id).innerHTML);
    } else {
        quantity = 1;
        price = parseFloat(document.getElementById("price" + item_id).innerHTML);
        name = document.getElementById("nm" + item_id).innerHTML;
        cart[item_id] = [quantity, name, price];
    }

    localStorage.setItem('cart', JSON.stringify(cart));

    console.log("Added to cart.");
    console.log(cart);

    jq("#cart").empty();
    cartItems(cart);

}

function cartItems(cart) {
    let total = 0

    for (item in cart) {
        let quantity = cart[item][0];
        let name = cart[item][1];
        let price = cart[item][2];
        itemString = `<li>
                        <a href="#" class="minicart-product-image">
                            <img src="/static/assets/images/product/small-size/5.jpg"
                                 alt="cart products">
                        </a>
                        <div class="minicart-product-details">
                            <h6><a href="#">${name}</a></h6>
                            <span>£${price / quantity} x ${quantity}</span>
                        </div>
                        <button class="close" title="Remove">
                            <i class="fa fa-close"></i>
                        </button>
                    </li>`;
        jq("#cart").append(itemString);

        total += parseFloat(price)
    }

    document.getElementById("total1").innerHTML = `£${total}<span class="cart-item-count">${Object.keys(cart).length}</span>`
    document.getElementById("total2").innerHTML = `£${total}`
}

var jq = $.noConflict();
jq(document).ready(function () {
    jq(document).on("click", ".my-cart", addToCart);

    cartItems(cart);

});
